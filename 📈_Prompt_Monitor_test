import streamlit as st

import numpy as np

import datetime

import thingspeak

import pandas as pd

import yfinance as yf

import json



st.set_page_config(page_title="Monitor", page_icon="ğŸ“ˆ" , layout="wide" )

channel_id = 2528199

write_api_key = '2E65V8XEIPH9B2VV'

client = thingspeak.Channel(channel_id, write_api_key , fmt='json')



def sell (asset = 0 , fix_c=1500 , Diff=60):

Â  Â  s1 =Â  (1500-Diff) /asset

Â  Â  s2 =Â  round(s1, 2)

Â  Â  s3 =Â  s2Â  *asset

Â  Â  s4 =Â  abs(s3 - fix_c)

Â  Â  s5 =Â  round( s4 / s2 )

Â  Â  s6 =Â  s5*s2

Â  Â  s7 =Â  (asset * s2) + s6

Â  Â  return s2 , s5 , round(s7, 2)



def buy (asset = 0 , fix_c=1500 , Diff=60):

Â  Â  b1 =Â  (1500+Diff) /asset

Â  Â  b2 =Â  round(b1, 2)

Â  Â  b3 =Â  b2 *asset

Â  Â  b4 =Â  abs(b3 - fix_c)

Â  Â  b5 =Â  round( b4 / b2 )

Â  Â  b6 =Â  b5*b2

Â  Â  b7 =Â  (asset * b2) - b6

Â  Â  return b2 , b5 , round(b7, 2)



channel_id_2 = 2385118

write_api_key_2 = 'IPSG3MMMBJEB9DY8'

client_2 = thingspeak.Channel(channel_id_2, write_api_key_2 , fmt='json' )



def Monitor (Ticker = 'FFWM' , field = 2Â  ):



Â  Â  tickerData = yf.Ticker(Ticker)

Â  Â  tickerData = round(tickerData.history(period= 'max' )[['Close']] , 3 )

Â  Â  tickerData.index = tickerData.index.tz_convert(tz='Asia/bangkok')

Â  Â  filter_date = '2023-01-01 12:00:00+07:00'

Â  Â  tickerData = tickerData[tickerData.index >= filter_date]



Â  Â  fx = client_2.get_field_last(field='{}'.format(field))

Â  Â  fx_js = int(json.loads(fx)["field{}".format(field)])

Â  Â  rng = np.random.default_rng(fx_js)

Â  Â  data = rng.integers(2, size = len(tickerData))

Â  Â  tickerData['action'] = data

Â  Â  tickerData['index'] = [ i+1 for i in range(len(tickerData))]



Â  Â  tickerData_1 = pd.DataFrame(columns=(tickerData.columns))

Â  Â  tickerData_1['action'] =Â  [ i for i in range(5)]

Â  Â  tickerData_1.index = ['+0' , "+1" , "+2" , "+3" , "+4"]

Â  Â  df = pd.concat([tickerData , tickerData_1], axis=0).fillna("")

Â  Â  rng = np.random.default_rng(fx_js)

Â  Â  df['action'] = rng.integers(2, size = len(df))

Â  Â  return df.tail(7) , fx_js



df_7Â  Â , fx_jsÂ  Â  = Monitor(Ticker = 'FFWM', field = 2Â  Â  )

df_7_1 , fx_js_1Â  = Monitor(Ticker = 'NEGG', field = 3Â  Â  )

df_7_2 , fx_js_2Â  = Monitor(Ticker = 'RIVN', field = 4 )

df_7_3 , fx_js_3Â  = Monitor(Ticker = 'APLS', field = 5 )

df_7_4 , fx_js_4Â  = Monitor(Ticker = 'NVTS', field = 6 )

df_7_5 , fx_js_5Â  = Monitor(Ticker = 'QXO', field = 7 )



nex = 0

Nex_day_sell = 0

toggle = lambda x : 1 - x



Nex_day_ = st.checkbox('nex_day')

if Nex_day_ :

Â  Â  st.write( "value = " , nex)

Â  Â  nex_col , Nex_day_sell_col ,_,_,_Â  = st.columns(5)



Â  Â  if nex_col.button("Nex_day"):

Â  Â  Â  Â  nex = 1

Â  Â  Â  Â  st.write( "value = " , nex)



Â  Â  if Nex_day_sell_col.button("Nex_day_sell"):

Â  Â  Â  Â  nex = 1

Â  Â  Â  Â  Nex_day_sell = 1

Â  Â  Â  Â  st.write( "value = " , nex)

Â  Â  Â  Â  st.write( "Nex_day_sell = " , Nex_day_sell)



st.write("_____")



col13, col16, col14, col15, col17, col18, col19, col20 = st.columns(8)



x_2 = col16.number_input('Diff', step=1 , value= 60Â  Â )



Start = col13.checkbox('start')

if Start :

Â  Â  thingspeak_1 = col13.checkbox('@_FFWM_ASSET')

Â  Â  if thingspeak_1 :

Â  Â  Â  Â  add_1 = col13.number_input('@_FFWM_ASSET', step=0.001 ,Â  value=0.)

Â  Â  Â  Â  _FFWM_ASSET = col13.button("GO!")

Â  Â  Â  Â  if _FFWM_ASSET :

Â  Â  Â  Â  Â  Â  client.update(Â  {'field1': add_1 } )

Â  Â  Â  Â  Â  Â  col13.write(add_1)



Â  Â  thingspeak_2 = col13.checkbox('@_NEGG_ASSET')

Â  Â  if thingspeak_2 :

Â  Â  Â  Â  add_2 = col13.number_input('@_NEGG_ASSET', step=0.001 ,Â  value=0.)

Â  Â  Â  Â  _NEGG_ASSET = col13.button("GO! ")

Â  Â  Â  Â  if _NEGG_ASSET :

Â  Â  Â  Â  Â  Â  client.update(Â  {'field2': add_2 }Â  )

Â  Â  Â  Â  Â  Â  col13.write(add_2)



Â  Â  thingspeak_3 = col13.checkbox('@_RIVN_ASSET')

Â  Â  if thingspeak_3 :

Â  Â  Â  Â  add_3 = col13.number_input('@_RIVN_ASSET', step=0.001 ,Â  value=0.)

Â  Â  Â  Â  _RIVN_ASSET = col13.button("GO!Â  ")

Â  Â  Â  Â  if _RIVN_ASSET :

Â  Â  Â  Â  Â  Â  client.update(Â  {'field3': add_3 }Â  )

Â  Â  Â  Â  Â  Â  col13.write(add_3)



Â  Â  thingspeak_4 = col13.checkbox('@_APLS_ASSET')

Â  Â  if thingspeak_4 :

Â  Â  Â  Â  add_4 = col13.number_input('@_APLS_ASSET', step=0.001 ,Â  value=0.)

Â  Â  Â  Â  _APLS_ASSET = col13.button("GO!Â  Â ")

Â  Â  Â  Â  if _APLS_ASSET :

Â  Â  Â  Â  Â  Â  client.update(Â  {'field4': add_4 }Â  )

Â  Â  Â  Â  Â  Â  col13.write(add_4)



Â  Â  thingspeak_5 = col13.checkbox('@_NVTS_ASSET')

Â  Â  if thingspeak_5:

Â  Â  Â  Â  add_5 = col13.number_input('@_NVTS_ASSET', step=0.001, value= 0.)

Â  Â  Â  Â  _NVTS_ASSET = col13.button("GO!Â  Â  ")

Â  Â  Â  Â  if _NVTS_ASSET:

Â  Â  Â  Â  Â  Â  client.update({'field5': add_5})

Â  Â  Â  Â  Â  Â  col13.write(add_5)



Â  Â  thingspeak_6 = col13.checkbox('@_QXO_ASSET')

Â  Â  if thingspeak_6:

Â  Â  Â  Â  add_6 = col13.number_input('@_QXO_ASSET', step=0.001, value=0.)

Â  Â  Â  Â  _QXO_ASSET = col13.button("GO!Â  Â  Â ")

Â  Â  Â  Â  if _QXO_ASSET:

Â  Â  Â  Â  Â  Â  client.update({'field6': add_6})

Â  Â  Â  Â  Â  Â  col13.write(add_6)







FFWM_ASSET_LAST = client.get_field_last(field='field1')

FFWM_ASSET_LAST =Â  eval(json.loads(FFWM_ASSET_LAST)['field1'])



NEGG_ASSET_LAST = client.get_field_last(field='field2')

NEGG_ASSET_LAST = eval(json.loads(NEGG_ASSET_LAST)['field2'])



RIVN_ASSET_LAST = client.get_field_last(field='field3')

RIVN_ASSET_LAST = eval(json.loads(RIVN_ASSET_LAST)['field3'])



APLS_ASSET_LAST = client.get_field_last(field='field4')

APLS_ASSET_LAST = eval(json.loads(APLS_ASSET_LAST)['field4'])



NVTS_ASSET_LAST = client.get_field_last(field='field5')

NVTS_ASSET_LAST = eval(json.loads(NVTS_ASSET_LAST)['field5'])



QXO_ASSET_LAST = client.get_field_last(field='field6') ####

QXO_ASSET_LAST = eval(json.loads(QXO_ASSET_LAST)['field6'])





x_3 = col14.number_input('NEGG_ASSET', step=0.001 ,Â  value= NEGG_ASSET_LAST )

x_4 = col15.number_input('FFWM_ASSET', step=0.001Â  , value= FFWM_ASSET_LASTÂ  Â  )

x_5 = col17.number_input('RIVN_ASSET', step=0.001Â  , value= RIVN_ASSET_LASTÂ  Â  )

x_6 = col18.number_input('APLS_ASSET', step=0.001Â  , value= APLS_ASSET_LASTÂ  Â  )

x_7 = col19.number_input('NVTS_ASSET', step=0.001Â  , value= NVTS_ASSET_LAST )

x_8 =Â  col20 .number_input('QXO_ASSET', step=0.001Â  , value= QXO_ASSET_LAST )



st.write("_____")



# try:



s8 , s9 , s10 =Â  sell( asset = x_3 , Diff= x_2)

s11 , s12 , s13 =Â  sell(asset = x_4 , Diff= x_2)

b8 , b9 , b10 =Â  buy(asset = x_3 , Diff= x_2)

b11 , b12 , b13 =Â  buy(asset = x_4 , Diff= x_2)

u1 , u2 , u3 = sell( asset = x_5 , Diff= x_2)

u4 , u5 , u6 = buy( asset = x_5 , Diff= x_2)

p1 , p2 , p3 = sell( asset = x_6 , Diff= x_2)

p4 , p5 , p6 = buy( asset = x_6 , Diff= x_2)

u7 , u8 , u9 = sell( asset = x_7 , Diff= x_2)

p7 , p8 , p9 = buy( asset = x_7 , Diff= x_2)

q1, q2, q3 = sell(asset=x_8, Diff=x_2)

q4, q5, q6 = buy(asset=x_8, Diff=x_2)





Limut_Order_NEGG = st.checkbox('Limut_Order_NEGG', value =Â  np.where(Â  Nex_day_sell == 1 ,Â  toggle(Â  df_7_1.action.values[1+nex] )Â  Â ,Â  df_7_1.action.values[1+nex]Â  Â ))

if Limut_Order_NEGG :

Â  Â  st.write( 'sell' , 'Â  Â  ' ,'A', b9Â  , 'P' , b8 ,'C' ,b10Â  Â  )



Â  Â  col1, col2 , col3Â  = st.columns(3)

Â  Â  sell_negg = col3.checkbox('sell_match_NEGG')

Â  Â  if sell_negg :

Â  Â  Â  Â  GO_NEGG_SELL = col3.button("GO!Â  Â  Â ")

Â  Â  Â  Â  if GO_NEGG_SELL :

Â  Â  Â  Â  Â  Â  client.update(Â  {'field2': NEGG_ASSET_LAST - b9Â  } )

Â  Â  Â  Â  Â  Â  col3.write(NEGG_ASSET_LAST - b9)



Â  Â  pv_negg =Â  yf.Ticker('NEGG').fast_info['lastPrice'] * x_3

Â  Â  st.write(yf.Ticker('NEGG').fast_info['lastPrice'] , pv_neggÂ  ,'(',Â  pv_negg - 1500 ,')',Â  )



Â  Â  col4, col5 , col6Â  = st.columns(3)

Â  Â  st.write( 'buy' , 'Â  Â  ','A',Â  s9Â  ,Â  'P' , s8 , 'C' ,s10Â  Â  )

Â  Â  buy_negg = col6.checkbox('buy_match_NEGG')

Â  Â  if buy_negg :

Â  Â  Â  Â  GO_NEGG_Buy = col6.button("GO!Â  Â  Â  ")

Â  Â  Â  Â  if GO_NEGG_Buy :

Â  Â  Â  Â  Â  Â  client.update(Â  {'field2': NEGG_ASSET_LAST + s9Â  } )

Â  Â  Â  Â  Â  Â  col6.write(NEGG_ASSET_LAST + s9)



st.write("_____")



Limut_Order_FFWM = st.checkbox('Limut_Order_FFWM',Â  value =Â  np.where(Â  Nex_day_sell == 1 ,Â  toggle(Â  df_7.action.values[1+nex] )Â  Â ,Â  df_7.action.values[1+nex]Â  Â ))

if Limut_Order_FFWM :

Â  Â  st.write( 'sell' , 'Â  Â  ' , 'A', b12 , 'P' , b11Â  , 'C' , b13Â  Â  )



Â  Â  col7, col8 , col9Â  = st.columns(3)

Â  Â  sell_ffwm = col9.checkbox('sell_match_FFWM')

Â  Â  if sell_ffwm :

Â  Â  Â  Â  GO_ffwm_sell = col9.button("GO!Â  Â  Â  Â ")

Â  Â  Â  Â  if GO_ffwm_sell :

Â  Â  Â  Â  Â  Â  client.update(Â  {'field1': FFWM_ASSET_LAST - b12Â  } )

Â  Â  Â  Â  Â  Â  col9.write(FFWM_ASSET_LAST - b12)



Â  Â  pv_ffwm =Â  Â yf.Ticker('FFWM').fast_info['lastPrice'] * x_4

Â  Â  st.write(yf.Ticker('FFWM').fast_info['lastPrice'] , pv_ffwm ,'(',Â  pv_ffwm - 1500 ,')', )



Â  Â  col10, col11 , col12Â  = st.columns(3)

Â  Â  st.write(Â  'buy' , 'Â  Â  ', 'A', s12 , 'P' , s11Â  , 'C'Â  , s13Â  Â  )

Â  Â  buy_ffwm = col12.checkbox('buy_match_FFWM')

Â  Â  if buy_ffwm :

Â  Â  Â  Â  GO_ffwm_Buy = col12.button("GO!Â  Â  Â  Â  ")

Â  Â  Â  Â  if GO_ffwm_Buy :

Â  Â  Â  Â  Â  Â  client.update(Â  {'field1': FFWM_ASSET_LAST + s12Â  } )

Â  Â  Â  Â  Â  Â  col12.write(FFWM_ASSET_LAST + s12)



st.write("_____")



Limut_Order_RIVN = st.checkbox('Limut_Order_RIVN',value =Â  np.where(Â  Nex_day_sell == 1 ,Â  toggle(Â  df_7_2.action.values[1+nex] )Â  Â ,Â  df_7_2.action.values[1+nex]Â  Â ))

if Limut_Order_RIVN :

Â  Â  st.write( 'sell' , 'Â  Â  ' , 'A', u5 , 'P' , u4Â  , 'C' , u6Â  Â  )



Â  Â  col77, col88 , col99Â  = st.columns(3)

Â  Â  sell_RIVN = col99.checkbox('sell_match_RIVN')

Â  Â  if sell_RIVN :

Â  Â  Â  Â  GO_RIVN_sell = col99.button("GO!Â  Â  Â  Â  Â ")

Â  Â  Â  Â  if GO_RIVN_sell :

Â  Â  Â  Â  Â  Â  client.update(Â  {'field3': RIVN_ASSET_LAST - u5Â  } )

Â  Â  Â  Â  Â  Â  col99.write(RIVN_ASSET_LAST - u5)



Â  Â  pv_rivn =Â  Â yf.Ticker('RIVN').fast_info['lastPrice'] * x_5

Â  Â  st.write(yf.Ticker('RIVN').fast_info['lastPrice'] , pv_rivn ,'(',Â  pv_rivn - 1500 ,')', )



Â  Â  col100 , col111 , col122Â  = st.columns(3)

Â  Â  st.write(Â  'buy' , 'Â  Â  ', 'A', u2 , 'P' , u1Â  , 'C'Â  , u3Â  Â  )

Â  Â  buy_RIVN = col122.checkbox('buy_match_RIVN')

Â  Â  if buy_RIVN :

Â  Â  Â  Â  GO_RIVN_Buy = col122.button("GO!Â  Â  Â  Â  Â  ")

Â  Â  Â  Â  if GO_RIVN_Buy :

Â  Â  Â  Â  Â  Â  client.update(Â  {'field3': RIVN_ASSET_LAST + u2Â  } )

Â  Â  Â  Â  Â  Â  col122.write(RIVN_ASSET_LAST + u2)



st.write("_____")



Limut_Order_APLS = st.checkbox('Limut_Order_APLS',value =Â  np.where(Â  Nex_day_sell == 1 ,Â  toggle(Â  df_7_3.action.values[1+nex] )Â  Â ,Â  df_7_3.action.values[1+nex]Â  Â ))

if Limut_Order_APLS :

Â  Â  st.write( 'sell' , 'Â  Â  ' , 'A', p5 , 'P' , p4Â  , 'C' , p6Â  Â  )



Â  Â  col7777, col8888 , col9999Â  = st.columns(3)

Â  Â  sell_APLS = col9999.checkbox('sell_match_APLS')

Â  Â  if sell_APLS :

Â  Â  Â  Â  GO_APLS_sell = col9999.button("GO!Â  Â  Â  Â  Â  Â ")

Â  Â  Â  Â  if GO_APLS_sell :

Â  Â  Â  Â  Â  Â  client.update(Â  {'field4': APLS_ASSET_LAST - p5Â  } )

Â  Â  Â  Â  Â  Â  col9999.write(APLS_ASSET_LAST - p5)



Â  Â  pv_apls =Â  Â yf.Ticker('APLS').fast_info['lastPrice'] * x_6

Â  Â  st.write(yf.Ticker('APLS' ).fast_info['lastPrice'] , pv_apls ,'(',Â  pv_apls - 1500 ,')', )



Â  Â  col1000 , col1111 , col1222Â  = st.columns(3)

Â  Â  st.write(Â  'buy' , 'Â  Â  ', 'A', p2 , 'P' , p1Â  , 'C'Â  , p3Â  Â  )

Â  Â  buy_APLS = col1222.checkbox('buy_match_APLS')

Â  Â  if buy_APLS :

Â  Â  Â  Â  GO_APLS_Buy = col1222.button("GO!Â  Â  Â  Â  Â  Â  ")

Â  Â  Â  Â  if GO_APLS_Buy :

Â  Â  Â  Â  Â  Â  client.update(Â  {'field4': APLS_ASSET_LAST + p2Â  } )

Â  Â  Â  Â  Â  Â  col1222.write(APLS_ASSET_LAST + p2)



st.write("_____")



Limut_Order_NVTS = st.checkbox('Limut_Order_NVTS', np.where(Â  Nex_day_sell == 1 ,Â  toggle(Â  df_7_4.action.values[1+nex] )Â  Â ,Â  df_7_4.action.values[1+nex]Â  Â ))

if Limut_Order_NVTS:

Â  Â  st.write('sell', 'Â  Â  ', 'A', p8 , 'P', p7Â  , 'C', p9Â  Â  )



Â  Â  col_nvts1, col_nvts2, col_nvts3 = st.columns(3)

Â  Â  sell_NVTS = col_nvts3.checkbox('sell_match_NVTS')



Â  Â  if sell_NVTS:

Â  Â  Â  Â  GO_NVTS_sell = col_nvts3.button("GO!Â  Â  Â  Â  Â  Â  Â ")

Â  Â  Â  Â  if GO_NVTS_sell:

Â  Â  Â  Â  Â  Â  client.update({'field5': NVTS_ASSET_LAST - p8})

Â  Â  Â  Â  Â  Â  col_nvts3.write(NVTS_ASSET_LAST - p8)



Â  Â  pv_nvts = yf.Ticker('NVTS').fast_info['lastPrice'] * x_7

Â  Â  st.write(yf.Ticker('NVTS').fast_info['lastPrice'], pv_nvts, '(', pv_nvts - 1500, ')')



Â  Â  col_nvts4, col_nvts5, col_nvts6 = st.columns(3)

Â  Â  st.write('buy', 'Â  Â  ', 'A', u8, 'P', u7Â  , 'C',u9 )

Â  Â  buy_NVTS = col_nvts6.checkbox('buy_match_NVTS')

Â  Â  if buy_NVTS:

Â  Â  Â  Â  GO_NVTS_Buy = col_nvts6.button("GO!Â  Â  Â  Â  Â  Â  Â  ")

Â  Â  Â  Â  if GO_NVTS_Buy:

Â  Â  Â  Â  Â  Â  client.update({'field5': NVTS_ASSET_LAST + u8})

Â  Â  Â  Â  Â  Â  col_nvts6.write(NVTS_ASSET_LASTÂ  + u8)



st.write("_____")



Limut_Order_QXO = st.checkbox('Limut_Order_QXO', np.where(Nex_day_sell == 1, toggle(df_7_5.action.values[1+nex]), df_7_5.action.values[1+nex]))

if Limut_Order_QXO:

Â  Â  st.write('sell', 'Â  Â  ', 'A', q5, 'P', q4, 'C', q6)



Â  Â  col_qxo1, col_qxo2, col_qxo3 = st.columns(3)

Â  Â  sell_QXO = col_qxo3.checkbox('sell_match_QXO')



Â  Â  if sell_QXO:

Â  Â  Â  Â  GO_QXO_sell = col_qxo3.button("GO!Â  Â  Â  Â  Â  Â  Â  Â ")

Â  Â  Â  Â  if GO_QXO_sell:

Â  Â  Â  Â  Â  Â  client.update({'field6': QXO_ASSET_LAST - q5})

Â  Â  Â  Â  Â  Â  col_qxo3.write(QXO_ASSET_LAST - q5)



Â  Â  pv_qxo = yf.Ticker('QXO').fast_info['lastPrice'] * x_8

Â  Â  st.write(yf.Ticker('QXO').fast_info['lastPrice'], pv_qxo, '(', pv_qxo - 1500, ')')



Â  Â  col_qxo4, col_qxo5, col_qxo6 = st.columns(3)

Â  Â  st.write('buy', 'Â  Â  ', 'A', q2, 'P', q1, 'C', q3)

Â  Â  buy_QXO = col_qxo6.checkbox('buy_match_QXO')

Â  Â  if buy_QXO:

Â  Â  Â  Â  GO_QXO_Buy = col_qxo6.button("GO!Â  Â  Â  Â  Â  Â  Â  Â  ")

Â  Â  Â  Â  if GO_QXO_Buy:

Â  Â  Â  Â  Â  Â  client.update({'field6': QXO_ASSET_LAST + q2})

Â  Â  Â  Â  Â  Â  col_qxo6.write(QXO_ASSET_LAST + q2)



st.write("_____")





if st.button("RERUN"):

Â  Â  st.rerun()





# except:pass







@ à¹€à¸à¸´à¹ˆà¸¡ Ticker 'RXRX'

RXRX channel_id = 2528199 à¸„à¸·à¸­ Field 7

RXRX channel_id = 2385118 à¸„à¸·à¸­ Field 8



à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¹‚à¸„à¹à¸”à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡ à¹à¸¥à¸° à¹ƒà¸«à¹‰à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡à¸—à¸¸à¸à¸›à¸£à¸°à¸à¸²à¸£

à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¹ƒà¸ªà¹ˆ # CommentÂ 
